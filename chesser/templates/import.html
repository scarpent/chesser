{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Import/Export</title>
    <link rel="icon" href="{% static 'favicon.ico' %}" type="image/x-icon" />
    <link href="{% static 'css/chesser.css' %}" rel="stylesheet" />
  </head>
  <body x-data="importApp()" x-init="init()" x-cloak>
    <div class="button-container">
      <button @click="window.location.href='/'" title="Home">üè†Ô∏è</button>
      <button @click="window.location.href='/review/'" title="Review">üìù</button>
    </div>

    {% if messages %}
    <ul class="import-status">
      {% for message in messages %}
      <li class="message {{ message.tags }}">{{ message }}</li>
      {% endfor %}
    </ul>
    {% endif %}

    <div style="width: 50%">
      <h2>Import Variation JSON</h2>
      <form method="POST" action="{% url 'import_chesser_json' %}">
        {% csrf_token %}

        <div style="margin-bottom: 1em">
          <label for="chapter">Chapter:</label>
          <select name="chapter_id" id="chapter">
            <template x-for="chapter in chapters" :key="chapter.id">
              <option :value="chapter.id" x-text="chapter.label"></option>
            </template>
          </select>
        </div>

        <div style="margin-bottom: 1em">
          <label for="variation_name">Variation Name:</label>
          <input
            type="text"
            name="variation_name"
            x-model="formDefaults.variation_name"
          />
        </div>

        <div style="margin-bottom: 1em">
          <label for="start_move">Start Move:</label>
          <input type="text" name="start_move" x-model="formDefaults.start_move" />
        </div>

        <div style="margin-bottom: 1em">
          <label for="next_review_date">Next Review Date:</label>
          <input
            type="date"
            name="next_review_date"
            id="next_review_date"
            x-model="formDefaults.next_review_date"
          />
        </div>

        <div style="margin-bottom: 1em">
          <label for="json_data">Paste JSON:</label><br />
          <textarea
            name="json_data"
            id="json_data"
            x-model="formDefaults.json_data"
            rows="20"
            style="width: 100%; box-sizing: border-box"
            placeholder="Paste your JSON here..."
            required
          ></textarea>
        </div>

        <button type="submit">üì•Ô∏è</button>
      </form>
    </div>

    <div>
      <h3>Upload to /tmp/upload.json</h3>
      <form
        method="POST"
        enctype="multipart/form-data"
        action="{% url 'upload_json_data' %}"
      >
        {% csrf_token %}
        <input type="file" name="uploaded_file" />
        <button type="submit">‚§¥Ô∏è</button>
      </form>
    </div>

    <div>
      <h3>Variations Listing</h3>
      <ul>
        <li><a href="/variations.tsv/" target="_blank">variations.tsv</a></li>
        <li><a href="/variations-table/" target="_blank">table</a></li>
      </ul>
    </div>

    {% include "includes/landscape_overlay.html" %}

    <script>
      window.importData = JSON.parse("{{ import_data|escapejs }}");
      console.log("importData:", window.importData);
    </script>

    <script type="module">
      import { importApp } from "{% static 'js/import.js' %}";
      window.importApp = importApp;
      document.addEventListener("alpine:init", () => {
        Alpine.data("importApp", importApp);
      });
    </script>

    <script defer src="{% static 'alpine/cdn.min.js' %}"></script>
  </body>
</html>
